<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>现学现用</title>
    <style>
        iframe {
            position: absolute;
            left: 160px;
            width: calc(100vw - 615px);
            top: 8px;
            height: 400px;
        }
        .info {
            font-size: 12px;
            color: #999;
            width: 150px;
            margin-bottom: 6px;
        }
    </style>
</head>
<body>
    <div class="info">场景：心中有事情犹豫不决时，丢上6次获得卦辞</div>
    <div>
        <button onclick="createGua()">丢卦(<label id="guaIndex">6</label>)</button>
        <button onclick="reset()">重新开始</button>
    </div>
    <pre id="desc"></pre>
    <canvas width="120" height="140" id="cvs"></canvas>
    <iframe src="about:blank" id="ifr1"></iframe>
</body>
<script>
    const guaObj = {
        '111111': '乾为天',
        '011111': '天风姤',
        '001111': '天山遁',
        '000111': '天地否',
        '000011': '风地观',
        '000001': '山地剥',
        '000101': '火地晋',
        '111101': '火天大有',
        '010010': '坎为水',
        '110010': '水泽节',
        '100010': '水雷屯',
        '101010': '水火既济',
        '101110': '泽火革',
        '101100': '雷火丰',
        '101000': '地火明夷',
        '010000': '地水师',
        '001001': '艮为山',
        '101001': '山火贲',
        '111001': '山天大畜',
        '110001': '山泽损',
        '110101': '火泽睽',
        '110111': '天泽履',
        '110011': '风泽中孚',
        '001011': '风山渐',
        '100100': '震为雷',
        '000100': '雷地豫',
        '010100': '雷水解',
        '011100': '雷风恒',
        '011000': '地风升',
        '011010': '水风井',
        '011110': '泽风大过',
        '100110': '泽雷随',
        '011011': '巽为风',
        '111011': '风天小畜',
        '101011': '风火家人',
        '100011': '风雷益',
        '100111': '天雷无妄',
        '100101': '火雷噬嗑',
        '100001': '山雷颐',
        '011001': '山风蛊',
        '101101': '离为火',
        '001101': '火山旅',
        '011101': '火风鼎',
        '010101': '水火未济',
        '010001': '山水蒙',
        '010011': '风水涣',
        '010111': '天水讼',
        '101111': '天火同人',
        '000000': '坤为地',
        '100000': '地雷复',
        '110000': '地泽临',
        '111000': '地天泰',
        '111100': '雷天大壮',
        '111110': '泽天夬',
        '111010': '水天需',
        '000010': '水地比',
        '110110': '兑为泽',
        '010110': '泽水困',
        '000110': '泽地萃',
        '001110': '泽山咸',
        '001010': '水山蹇',
        '001000': '地山谦',
        '001100': '雷山小过',
        '110100': '雷泽归妹',
    }
    const cvs = document.getElementById('cvs')
    const ctx = cvs.getContext('2d')
    const guaIndexEl = document.getElementById('guaIndex')
    const descEl = document.getElementById('desc')
    const ifr1 = document.getElementById('ifr1')
    const {width, height} = cvs
    let guaIndex = +guaIndexEl.innerHTML
    let result = []
    // 计算卦的公式
    const getGua = () => {
        const a = Math.random() > 0.5 ? 3 : 2
        const b = Math.random() > 0.5 ? 3 : 2
        const c = Math.random() > 0.5 ? 3 : 2
        descEl.innerHTML = `${a === 3 ? '阳':'阴'}\t${b === 3 ? '阳':'阴'}\t${c === 3 ? '阳':'阴'}`
        return a + b + c
    }
    // 丢卦事件
    const createGua = () => {
        if (guaIndex > 0) {
            guaIndex--
            result.push(getGua())
            guaIndexEl.innerHTML = guaIndex
            render()
            if (guaIndex === 0) {
                const name = guaObj[result.map(v => (v === 6 || v === 8) ? 0 : 1).join('')]
                descEl.innerHTML = `卦名：${name}`
                ifr1.src = `https://baike.baidu.com/item/${name}?fromModule=lemma_search-box`
            }
        }
    }
    // 重新开始
    const reset = () => {
        guaIndex = 6
        guaIndexEl.innerHTML = guaIndex
        descEl.innerHTML = ''
        result = []
        ifr1.src = `about:blank`
        ctx.clearRect(0, 0, cvs.width, cvs.height)
    }
    // 卦图的渲染
    const render = () => {
        const bl = 2
        cvs.style.width = width + 'px'
        cvs.style.height = height + 'px'
        cvs.width = width * 2
        cvs.height = height * 2
        ctx.clearRect(0, 0, cvs.width, cvs.height)
        ctx.beginPath()
        let x = 10 * bl
        let w1 = 40 * bl
        let space = 8 * bl
        let w2 = w1 * 2 + space
        let h = 20 * bl
        ctx.lineWidth = h / 2
        ctx.textBaseline = 'middle'
        ctx.font = 16 * bl + 'px bold'
        result.forEach((v, i) => {
            const y = (result.length - i) * h
            ctx.fillText(v, x + w2 + 10, y)
            if (v === 6 || v === 8) {
                ctx.moveTo(x, y)
                ctx.lineTo(x + w1, y)
                ctx.moveTo(x + w1 + space, y)
                ctx.lineTo(x + w1 + space + w1, y)
            } else if (v === 7 || v === 9) {
                ctx.moveTo(x, y)
                ctx.lineTo(x + w2, y)
            }
        })
        ctx.stroke()
    }
</script>
</html>